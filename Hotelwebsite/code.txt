user-overview.php: 
<?php
require_once('form/dbaccess.php');

// Verbindung zur Datenbank herstellen
$db_obj = new mysqli($host, $user, $dbpassword, $database);

if ($db_obj->connect_error) {
    die("Connection failed: " . $db_obj->connect_error);
}

// Alle Benutzer abrufen
$sql = "SELECT * FROM users";
$result = $db_obj->query($sql);
?>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User-Overview</title>
    <!-- Bootstrap CSS -->
    <?php include('link.php'); ?>
</head>
<body>
<?php include('header.php'); ?>

<div class="container mt-5">
    <div class="p-4 border rounded bg-light mb-4">
        <h1>All Users</h1>
    </div>

    <table class="table table-striped table-bordered">
        <thead>
            <tr>
                <th>ID</th>
                <th>Salutation</th>
                <th>Firstname</th>
                <th>Lastname</th>
                <th>Email</th>
                <th>Username</th>
                <th>Password</th>
                <th>Role</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
        <?php
        if ($result->num_rows > 0) {
            while ($row = $result->fetch_assoc()) {
                echo '<tr>';
                echo '<td>' . htmlspecialchars($row['id']) . '</td>';
                echo '<td>' . htmlspecialchars($row['salutation']) . '</td>';
                echo '<td>' . htmlspecialchars($row['firstname']) . '</td>';
                echo '<td>' . htmlspecialchars($row['lastname']) . '</td>';
                echo '<td>' . htmlspecialchars($row['useremail']) . '</td>';
                echo '<td>' . htmlspecialchars($row['username']) . '</td>';
                echo '<td>' . htmlspecialchars($row['password']) . '</td>';
                echo '<td>' . htmlspecialchars($row['role']) . '</td>';
                echo '<td>' . htmlspecialchars($row['status']) . '</td>';
                echo '<td>';
                echo '<a href="edit-user.php?id=' . $row['id'] . '" class="btn btn-primary btn-sm">Edit</a>';
                echo '</td>';
                echo '</tr>';
            }
        } else {
            echo '<tr><td colspan="10" class="text-center">No users found.</td></tr>';
        }
        ?>
        </tbody>
    </table>
</div>

<?php include('footer.php'); ?>
<?php include('script.php'); ?>
</body>
</html>


edit-user.php: 

<?php
if (session_status() == PHP_SESSION_NONE) {
    session_start();
}

$current_id;
$profile_salutation;
$profile_firstname;
$profile_lastname;
$profile_email;
$profile_username;
$current_password;
$role;
$status;

require_once('form/dbaccess.php');
$db_obj = new mysqli($host, $user, $dbpassword, $database);

if ($db_obj->connect_error) {
    echo "Connection Error: " . $db_obj -> connect_error;
    exit();
}else{
    $current_id = $_GET['id'];
    $sql = "SELECT * FROM users WHERE id = '$current_id'";
    $result = $db_obj -> query($sql);
    $user_found = false;

    while ($row = $result->fetch_array()) { 
        
        $profile_salutation = $row['salutation'];
        $profile_firstname = $row['firstname'];
        $profile_lastname = $row['lastname'];
        $profile_email = $row['useremail'];
        $profile_username = $row['username'];
        $current_password = $row['password'];
        $role = $row['role'];
        $status = $row['status'];
        break;
    
    }
}



// Retrieve form data from session if available
$profile_form_data = $_SESSION['profile_form_data'] ?? [];
?>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit User</title>
    <!-- Bootstrap CSS -->
    <?php include('link.php'); ?>
</head>
<body>
<?php include('header.php'); 
if ( isset($_GET['update']) && $_GET['update'] == 'success') {
    echo "<div class='alert alert-success mt-3' role='alert'>Registration was successful.</div>";
}
?>


<div class="container mt-5">
    <h2>User</h2>
    <p><strong><?= htmlspecialchars($current_id); ?></strong></p>

    <!-- Display error messages -->
    <?php
    if (isset($_GET['error'])) {
        $error_message = '';
        switch ($_GET['error']) {
            case 'invalid_password':
                $error_message = 'New password must be at least 8 characters long, include at least one number, and one special character.';
                break;
            case 'invalid_email':
                $error_message = 'Please enter a valid email address.';
                break;
            case 'user_exists':
                $error_message = 'Username already exists.';
                break;
        }
        if (!empty($error_message)) {
            echo '<div class="alert alert-danger">' . htmlspecialchars($error_message) . '</div>';
        }
    }
    ?>

    <!-- Profile Details -->
    <form action="form/edit-user-form.php?id=<?php htmlspecialchars($current_id); ?>" method="POST">
        
        <div class="mb-3">
            <label for="username" class="form-label">Username</label>
            <input type="text" class="form-control" id="username" name="username"
                   value="<?php echo htmlspecialchars($profile_username); ?>" required>
        </div>
        <div class="mb-3">
            <label for="salutation" class="form-label">Salutation</label>
            <select id="salutation" name="salutation" class="form-control">
                <option value="Mr" <?php if ($profile_salutation == 'Mr') echo 'selected'; ?>>Mr</option>
                <option value="Mrs" <?php if ($profile_salutation == 'Mrs') echo 'selected'; ?>>Mrs</option>
                <option value="Divers" <?php if ($profile_salutation == 'Divers') echo 'selected'; ?>>Divers</option>
            </select>
        </div>
        <div class="mb-3">
            <label for="name" class="form-label">First Name</label>
            <input type="text" class="form-control" id="name" name="name"
                   value="<?php echo htmlspecialchars($profile_firstname); ?>" required>
        </div>
        <div class="mb-3">
            <label for="surname" class="form-label">Last Name</label>
            <input type="text" class="form-control" id="surname" name="surname"
                   value="<?php echo htmlspecialchars($profile_lastname); ?>" required>
        </div>
        <div class="mb-3">
            <label for="email" class="form-label">Email</label>
            <input type="email" class="form-control" id="email" name="email"
                   value="<?php echo htmlspecialchars($profile_email); ?>" required>
        </div>

        <div class="mb-3">
            <label for="role" class="form-label">Role</label>
            <input type="role" class="form-control" id="role" name="role"
                   value="<?php echo htmlspecialchars($role); ?>" required>
        </div>

        <div class="mb-3">
            <label for="status" class="form-label">Status</label>
            <input type="status" class="form-control" id="status" name="status"
                   value="<?php echo htmlspecialchars($status); ?>" required>
        </div>
        
        <div class="mb-3">
            <label for="new_password" class="form-label">New Password (if necessary)</label>
            <input type="password" class="form-control" id="new_password" name="new_password">
        </div>
        <button type="submit" class="btn btn-primary">Update user data</button>
    </form>
</div>

<?php include('footer.php'); ?>
<?php include('script.php'); ?>
</body>
</html>

edit-user-form.php: 

<?php
if (session_status() == PHP_SESSION_NONE) {
    session_start();
}

if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    $current_id = $_GET['id'];
    $username = trim($_POST['username']);
    $new_password = trim($_POST['new_password']);
    $salutation = trim($_POST['salutation']);
    $name = trim($_POST['name']);
    $surname = trim($_POST['surname']);
    $email = trim($_POST['email']);
    $role = trim($_POST['role']);
    $status = trim($_POST['status']);
    $hashed_password;
    
    // Store form data in session to retain values in case of an error
    $_SESSION['profile_form_data'] = [
        'username' => $username,
        'salutation' => $salutation,
        'name' => $name,
        'surname' => $surname,
        'email' => $email,
        'role' => $role,
        'status' => $status
    ];

    require_once('dbaccess.php');

    $db_obj = new mysqli($host, $user, $dbpassword, $database);
    
    if ($db_obj->connect_error) {
        echo "Connection Error: " . $db_obj->connect_error;
        exit();
    }else{
        $sql = "SELECT * FROM users";
        $result = $db_obj -> query($sql);
        

        while ($row = $result->fetch_array()) { 
            if ($row['username'] === $username) {
                
                
                header("Location: ../edit-user.php?id=$current_id&error=user_exists");
                exit();
            }
        }

        if(!empty($new_password)){
            if (strlen($new_password) < 8 ||
                !preg_match('/[0-9]/', $new_password) ||
                !preg_match('/[\W]/', $new_password)) {
                header("Location: edit-user.php?id=$current_id &error=invalid_password");
                exit();
            }else{
                $hashed_password = password_hash($new_password, PASSWORD_DEFAULT);
            }
        }else{
            $sql_find_current_pw = "SELECT * FROM users WHERE id = '$current_id'";
            $result = $db_obj -> query($sql_find_current_pw);
            while($row = $result->fetch_array()){
                $hashed_password = $row['password'];
            }
            
        }

        if (!filter_var($email, FILTER_VALIDATE_EMAIL)) {
            header("Location: edit-user.php?id=$current_id&error=invalid_email");
            exit();
        }

        

        $sql= "
        UPDATE users SET
        salutation= ?,
        firstname= ?,
        lastname=?, 
        useremail=?,
        username=?, 
        password=?,
        role=?,
        status=?
        WHERE id = '$current_id'
        ";

        $stmt = $db_obj->prepare($sql);
        $stmt->bind_param('ssssssss', $salutation, $name, $surname, $email, $username, $u_password, $role, $status);
        $stmt->execute();
    
        header("Location: user-edit.php?id=$current_id&update=success");
        
        exit();
            
        }
        
    }else{
        // Direct access is not allowed
        header("Location: home.php");
        exit();
    }

    

    

?>
